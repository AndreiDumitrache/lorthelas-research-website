<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Strategy | Lorthelas Research</title>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="apple-touch-icon" href="favicon.png">
    <meta name="description" content="Strategic portfolio insights, asset allocation methodology, and current market positioning">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .chart-container {
    width: 100%;
    max-width: 500px;
    margin: 0 auto 2rem auto;
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 15px rgba(107, 114, 128, 0.1);
    position: relative;
}

#allocation-chart {
    width: 100% !important;
    height: auto !important;
    max-height: 400px;
    transition: all 0.3s ease;
    cursor: pointer;
}

/* NEW: Professional chart enhancements */
.chart-tooltip {
    position: absolute;
    background: rgba(55, 65, 81, 0.95);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 500;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 1000;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.chart-center-label {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    pointer-events: none;
    font-weight: 600;
    color: #374151;
}

.chart-center-title {
    font-size: 0.9rem;
    color: #6b7280;
    margin-bottom: 0.25rem;
}

.chart-center-value {
    font-size: 1.4rem;
    font-weight: 700;
    color: #374151;
}
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
            background: #ffffff;
        }

        /* Header - always expanded on content pages */
        header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(51, 65, 85, 0.95);
            backdrop-filter: blur(15px);
            z-index: 1000;
            transition: all 0.4s ease;
        }

        .logo-header {
            padding: 0.8rem 0;
            text-align: center;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .logo {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ffffff;
            text-decoration: none;
        }

        .logo span {
            color: #94a3b8;
        }

        .nav-header {
            padding: 1rem 0;
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 3rem;
            margin: 0;
        }

        .nav-links a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            transition: color 0.3s ease;
        }

        .nav-links a:hover,
        .nav-links a.active {
            color: #94a3b8;
        }

        /* Page Content */
        .page-content {
            margin-top: 140px;
            padding: 4rem 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .page-title {
            font-size: 3rem;
            color: #374151;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .page-subtitle {
            font-size: 1.2rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Methodology Section */
        .methodology-section {
            margin-bottom: 4rem;
        }

        .methodology-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .methodology-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 8px 32px rgba(107, 114, 128, 0.12);
            transition: all 0.4s ease;
            border: 1px solid rgba(156, 163, 175, 0.2);
            position: relative;
            overflow: hidden;
        }

        .methodology-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #9ca3af, #6b7280);
            transform: scaleX(0);
            transition: transform 0.4s ease;
        }

        .methodology-card:hover::before {
            transform: scaleX(1);
        }

        .methodology-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(107, 114, 128, 0.2);
        }

        .methodology-card .icon {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: #6b7280;
            display: block;
        }

        .methodology-card h3 {
            color: #374151;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .methodology-card p {
            color: #6b7280;
            line-height: 1.7;
        }

        /* Current Positioning Section */
        .positioning-section {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            padding: 4rem 0;
            margin: 4rem 0;
        }

        .positioning-content {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .positioning-title {
            font-size: 2.5rem;
            color: #374151;
            margin-bottom: 2rem;
            font-weight: 700;
        }

        .positioning-description {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 3rem;
            line-height: 1.7;
        }

        .positioning-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .highlight-item {
            background: #ffffff;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(107, 114, 128, 0.1);
            transition: all 0.3s ease;
        }

        .highlight-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(107, 114, 128, 0.15);
        }

        .highlight-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .highlight-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .highlight-description {
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* Allocation Chart Section */
        .allocation-section {
            margin: 4rem 0;
        }

        .allocation-chart {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 8px 32px rgba(107, 114, 128, 0.12);
            border: 1px solid rgba(156, 163, 175, 0.2);
            text-align: center;
        }

        .chart-title {
            font-size: 1.8rem;
            color: #374151;
            margin-bottom: 2rem;
            font-weight: 600;
        }

        .chart-placeholder {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6b7280;
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 2rem;
        }

        .allocation-legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .legend-label {
            color: #374151;
            font-weight: 500;
        }

        .legend-percentage {
            color: #6b7280;
            margin-left: auto;
        }

        /* Performance Metrics */
        .metrics-section {
            margin: 4rem 0;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }

        .metric-card {
            background: #ffffff;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(107, 114, 128, 0.1);
            text-align: center;
            border: 1px solid rgba(156, 163, 175, 0.1);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .metric-period {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            color: #d1d5db;
            padding: 4rem 0 2rem 0;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .footer-nav {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .footer-nav a {
            color: #d1d5db;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .footer-nav a:hover {
            color: #94a3b8;
        }

        .footer-copyright {
            text-align: center;
            border-top: 1px solid #4b5563;
            padding-top: 2rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            /* Hide Home button on mobile */
            .nav-links li:first-child {
                display: none;
            }

            /* Compact header on mobile */
            .logo-header {
                padding: 0.5rem 0;
            }

            .logo {
                font-size: 1.2rem;
            }

            .nav-header {
                padding: 0.6rem 0;
            }

            .nav-links {
                gap: 1.2rem;
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-links a {
                font-size: 0.85rem;
                padding: 0.3rem 0.5rem;
            }

            .page-title {
                font-size: 2.5rem;
            }

            .methodology-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Financial Terms Tooltip */
        .financial-term {
            position: relative;
            border-bottom: 2px dotted #9ca3af;
            cursor: help;
            color: #6b7280;
        }

        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #374151;
            color: #f3f4f6;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .financial-term:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #374151;
        }
    </style>
    <!-- Favicon and Icons -->
<link rel="icon" type="image/png" href="/favicon.png">
<link rel="apple-touch-icon" href="/favicon.png">
<link rel="shortcut icon" href="/favicon.png">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://lorthelas.com">
<meta property="og:title" content="Lorthelas Research | Capital structuring & Investment strategy">
<meta property="og:description" content="Comprehensive analysis of macroeconomic trends, political economy dynamics, and global conflicts impact on financial markets">
<meta property="og:image" content="https://lorthelas.com/favicon.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://lorthelas.com">
<meta property="twitter:title" content="Lorthelas Research | Capital structuring & Investment strategy">
<meta property="twitter:description" content="Comprehensive analysis of macroeconomic trends, political economy dynamics, and global conflicts impact on financial markets">
<meta property="twitter:image" content="https://lorthelas.com/favicon.png">

<!-- Structured Data for Google -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Lorthelas Research",
  "description": "Capital structuring & Investment strategy",
  "url": "https://lorthelas.com",
  "logo": {
    "@type": "ImageObject",
    "url": "https://lorthelas.com/favicon.png",
    "width": 300,
    "height": 300
  },
  "sameAs": [
    "https://lorthelas.com"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": "",
    "contactType": "customer service",
    "email": "research@lorthelas.com"
  }
}
</script>
</head>
<body>
    <!-- Header -->
    <header id="header">
        <!-- Logo Header Row -->
        <div class="logo-header">
            <a href="index.html" class="logo">Lorthelas <span>Research</span></a>
        </div>
        
        <!-- Navigation Row -->
        <div class="nav-header">
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="reports.html">Reports</a></li>
                    <li><a href="portfolio.html" class="active">Portfolio</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Page Content -->
    <div class="page-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">Portfolio Strategy</h1>
                <p class="page-subtitle">Systematic approach to asset allocation combining macroeconomic analysis with tactical positioning for optimal risk-adjusted returns</p>
            </div>

            <!-- Methodology Section -->
            <div class="methodology-section">
                <h2 style="text-align: center; font-size: 2.5rem; color: #374151; margin-bottom: 1rem;">Investment Methodology</h2>
                <p style="text-align: center; color: #6b7280; max-width: 800px; margin: 0 auto 3rem auto; font-size: 1.1rem;">Our portfolio construction framework emphasizes diversification, risk management, and adaptive positioning based on evolving market conditions and macroeconomic fundamentals.</p>
                
                <div class="methodology-grid">
                    <div class="methodology-card">
                        <div class="icon">üéØ</div>
                        <h3>Strategic Asset Allocation</h3>
                        <p>Long-term allocation framework based on historical risk-return profiles, correlations, and expected market conditions. Emphasis on <span class="financial-term">diversification<span class="tooltip">Spreading investments across different assets to reduce risk</span></span> across asset classes, geographic regions, and investment styles.</p>
                    </div>
                    <div class="methodology-card">
                        <div class="icon">üìä</div>
                        <h3>Tactical Positioning</h3>
                        <p>Dynamic adjustment of portfolio weights based on short to medium-term market opportunities and risks. Incorporates technical analysis, sentiment indicators, and <span class="financial-term">momentum factors<span class="tooltip">Tendency for assets to continue moving in their current direction</span></span>.</p>
                    </div>
                    <div class="methodology-card">
                        <div class="icon">üõ°Ô∏è</div>
                        <h3>Risk Management</h3>
                        <p>Comprehensive risk assessment including <span class="financial-term">value at risk<span class="tooltip">Statistical measure of potential loss over a specific time period</span></span>, stress testing, and scenario analysis. Focus on capital preservation during market downturns while maintaining upside participation.</p>
                    </div>
                    <div class="methodology-card">
                        <div class="icon">üîÑ</div>
                        <h3>Rebalancing Discipline</h3>
                        <p>Systematic rebalancing approach combining calendar-based and threshold-based triggers. Maintains target allocations while harvesting gains and managing portfolio drift over time.</p>
                    </div>
                    <div class="methodology-card">
                        <div class="icon">üåç</div>
                        <h3>Global Perspective</h3>
                        <p>Integration of global macroeconomic analysis, geopolitical developments, and cross-border capital flows. Emphasis on identifying regional opportunities and managing currency exposure.</p>
                    </div>
                    <div class="methodology-card">
                        <div class="icon">‚öñÔ∏è</div>
                        <h3>ESG Integration</h3>
                        <p>Incorporation of environmental, social, and governance factors in investment decisions. Focus on sustainable business models and companies positioned for long-term success in a changing world.</p>
                    </div>
                </div>
            </div>

            <!-- Current Market Positioning -->
            <div class="positioning-section">
                <div class="container">
                    <div class="positioning-content">
                        <h2 class="positioning-title">Current Market Positioning</h2>
                        <p class="positioning-description">Based on our macroeconomic analysis and market assessment, we currently favor a defensive positioning with selective growth opportunities. Our strategy emphasizes capital preservation while maintaining exposure to structural growth themes and inflation-protected assets.</p>
                        
                        <div class="positioning-highlights">
                            <div class="highlight-item">
                                <div class="highlight-icon">üè¶</div>
                                <div class="highlight-title">Fixed Income Focus</div>
                                <div class="highlight-description">Overweight in short to intermediate duration bonds with inflation protection</div>
                            </div>
                            <div class="highlight-item">
                                <div class="highlight-icon">üè≠</div>
                                <div class="highlight-title">Quality Equity Selection</div>
                                <div class="highlight-description">Emphasis on companies with strong balance sheets and sustainable competitive advantages</div>
                            </div>
                            <div class="highlight-item">
                                <div class="highlight-icon">üõ°Ô∏è</div>
                                <div class="highlight-title">Commodity Exposure</div>
                                <div class="highlight-description">Strategic allocation to precious metals and energy as inflation hedges</div>
                            </div>
                            <div class="highlight-item">
                                <div class="highlight-icon">üí∞</div>
                                <div class="highlight-title">Cash Management</div>
                                <div class="highlight-description">Elevated cash positions for defensive purposes and tactical opportunities</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Asset Allocation Chart -->
            <div class="allocation-section">
                <div class="allocation-chart">
                    <h3 class="chart-title">Strategic Asset Allocation</h3>
                    <div class="chart-container">
                        <canvas id="allocation-chart" width="400" height="400"></canvas>
                        <div class="chart-tooltip" id="chart-tooltip"></div>
                        <div class="chart-center-label" id="chart-center-label">
                            <div class="chart-center-title">Total Assets</div>
                            <div class="chart-center-value">100%</div>
                        </div>
                    </div>
                    <div class="allocation-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #374151;"></div>
                            <span class="legend-label">Equities</span>
                            <span class="legend-percentage">45%</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #6b7280;"></div>
                            <span class="legend-label">Fixed Income</span>
                            <span class="legend-percentage">30%</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #9ca3af;"></div>
                            <span class="legend-label">Commodities</span>
                            <span class="legend-percentage">10%</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #d1d5db;"></div>
                            <span class="legend-label">Alternatives</span>
                            <span class="legend-percentage">10%</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f3f4f6;"></div>
                            <span class="legend-label">Cash</span>
                            <span class="legend-percentage">5%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="metrics-section">
                <h2 style="text-align: center; font-size: 2.5rem; color: #374151; margin-bottom: 3rem;">Key Performance Metrics</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">8.7%</div>
                        <div class="metric-label">Annual Return</div>
                        <div class="metric-period">3-Year Average</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">1.24</div>
                        <div class="metric-label"><span class="financial-term">Sharpe Ratio<span class="tooltip">Risk-adjusted return measure</span></span></div>
                        <div class="metric-period">3-Year Period</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">12.3%</div>
                        <div class="metric-label">Volatility</div>
                        <div class="metric-period">Annualized</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">-8.2%</div>
                        <div class="metric-label"><span class="financial-term">Max Drawdown<span class="tooltip">Peak-to-trough decline in investment value during a specific period</span></span></div>
                        <div class="metric-period">Since Inception</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">0.72</div>
                        <div class="metric-label"><span class="financial-term">Beta<span class="tooltip">Measure of an asset's volatility relative to the overall market</span></span></div>
                        <div class="metric-period">vs Global Equity</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">+2.1%</div>
                        <div class="metric-label"><span class="financial-term">Alpha<span class="tooltip">Excess return of an investment relative to a benchmark index</span></span></div>
                        <div class="metric-period">Annualized</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <nav class="footer-nav">
                <a href="index.html">Home</a>
                <a href="reports.html">Reports</a>
                <a href="portfolio.html">Portfolio</a>
                <a href="contact.html">Contact</a>
            </nav>
            <div class="footer-copyright">
                <p>&copy; 2025 Lorthelas Research. All rights reserved.</p>
                <p>Independent investment research and analysis</p>
            </div>
        </div>
    </footer>

    <script>
// Simple debug and portfolio loading
document.addEventListener('DOMContentLoaded', function() {
    console.log('Portfolio page loaded - testing CMS integration...');
    
    // Test loading portfolio data
    loadPortfolioData();
});

// Simplified portfolio data loading
async function loadPortfolioData() {
    try {
        console.log('Loading portfolio data...');
        
        const response = await fetch('https://api.github.com/repos/AndreiDumitrache/lorthelas-research-website/contents/content/portfolio/current-positioning.md');
        console.log('GitHub response status:', response.status);
        
        const file = await response.json();
        console.log('File found, downloading...');
        
        const contentResponse = await fetch(file.download_url);
        const content = await contentResponse.text();
        
        console.log('File content length:', content.length);
        console.log('First 200 chars:', content.substring(0, 200));
        
        // Extract specific metrics using regex (more reliable than YAML parsing)
        const annualReturn = extractValue(content, 'annual_return');
        const sharpeRatio = extractValue(content, 'sharpe_ratio');
        const volatility = extractValue(content, 'volatility');
        const maxDrawdown = extractValue(content, 'max_drawdown');
        const beta = extractValue(content, 'beta');
        const alpha = extractValue(content, 'alpha');
        
        console.log('Extracted values:', { annualReturn, sharpeRatio, volatility, maxDrawdown, beta, alpha });
        
        // Update metrics if found
        if (annualReturn) updateMetricByLabel('Annual Return', annualReturn);
        if (sharpeRatio) updateMetricByLabel('Sharpe Ratio', sharpeRatio);
        if (volatility) updateMetricByLabel('Volatility', volatility);
        if (maxDrawdown) updateMetricByLabel('Max Drawdown', maxDrawdown);
        if (beta) updateMetricByLabel('Beta', beta);
        if (alpha) updateMetricByLabel('Alpha', alpha);
        
        // Try to update allocation data
        // Try to update allocation data
        const allocationData = extractAllocationData(content);
        if (allocationData.length > 0) {
            updateAllocationLegend(allocationData);
            console.log('Updated allocation with', allocationData.length, 'items');
        } else {
            // Create default chart if no CMS data found
            console.log('No allocation data from CMS, creating default chart');
            createProfessionalAllocationChart();
        }
        
        console.log('Portfolio metrics updated successfully!');
        
    } catch (error) {
        console.error('Error loading portfolio data:', error);
        createProfessionalAllocationChart(); // Fallback to default chart
    }
}

// Extract value from YAML content using regex
function extractValue(content, key) {
    // Try multiple patterns to match different YAML formats
    const patterns = [
        new RegExp(`${key}:\\s*"([^"]*)"`, 'i'),     // "value"
        new RegExp(`${key}:\\s*'([^']*)'`, 'i'),     // 'value'
        new RegExp(`${key}:\\s*([^\\n\\r]+)`, 'i')   // value (no quotes)
    ];
    
    for (const pattern of patterns) {
        const match = content.match(pattern);
        if (match) {
            let value = match[1].trim();
            // Remove any trailing quotes
            value = value.replace(/^["']|["']$/g, '');
            console.log(`Found ${key}: ${value}`);
            return value;
        }
    }
    
    console.log(`Could not find ${key}`);
    return null;
}

// Update metric by finding the label
function updateMetricByLabel(labelText, newValue) {
    const labels = document.querySelectorAll('.metric-label');
    const values = document.querySelectorAll('.metric-value');
    
    labels.forEach((label, index) => {
        if (label.textContent.includes(labelText)) {
            console.log(`Updating ${labelText} to ${newValue}`);
            values[index].textContent = newValue;
        }
    });
}

// Simple allocation extraction function
function extractAllocationData(content) {
    const allocationData = [];
    
    // Look for allocation section patterns
    const lines = content.split('\n');
    let inAllocation = false;
    let currentItem = {};
    
    for (let line of lines) {
        line = line.trim();
        
        if (line === 'allocation:') {
            inAllocation = true;
            console.log('Found allocation section');
            continue;
        }
        
        if (inAllocation) {
            // End of allocation section
            if (line && !line.startsWith(' ') && !line.startsWith('-') && line.includes(':') && !line.includes('asset') && !line.includes('percentage') && !line.includes('color')) {
                break;
            }
            
            if (line.includes('- asset:') || line.includes('asset:')) {
                // Save previous item
                if (currentItem.asset) {
                    allocationData.push(currentItem);
                    console.log('Added allocation item:', currentItem);
                }
                // Start new item
                currentItem = {};
                const assetMatch = line.match(/asset:\s*"?([^"]+)"?/);
                if (assetMatch) {
                    currentItem.asset = assetMatch[1].trim();
                }
            } else if (line.includes('percentage:')) {
                const percentageMatch = line.match(/percentage:\s*(\d+)/);
                if (percentageMatch) {
                    currentItem.percentage = percentageMatch[1];
                }
            } else if (line.includes('color:')) {
                const colorMatch = line.match(/color:\s*"?([^"]+)"?/);
                if (colorMatch) {
                    currentItem.color = colorMatch[1].trim();
                }
            }
        }
    }
    
    // Add final item
    if (currentItem.asset) {
        allocationData.push(currentItem);
        console.log('Added final allocation item:', currentItem);
    }
    
    console.log('Total allocation items found:', allocationData.length);
    return allocationData;
}

// Update allocation legend
function updateAllocationLegend(allocation) {
    const legend = document.querySelector('.allocation-legend');
    if (!legend) {
        console.log('Allocation legend not found');
        return;
    }
    
    console.log('Updating allocation legend with:', allocation);
    
    legend.innerHTML = allocation.map(item => `
        <div class="legend-item">
            <div class="legend-color" style="background: ${item.color || '#374151'};"></div>
            <span class="legend-label">${item.asset}</span>
            <span class="legend-percentage">${item.percentage}%</span>
        </div>
    `).join('');
    
    // Update the chart too
    createProfessionalAllocationChart(allocation);
}

// ENHANCED: Create professional pie chart with animations and interactions
function createProfessionalAllocationChart(allocationData) {
    const canvas = document.getElementById('allocation-chart');
    const tooltip = document.getElementById('chart-tooltip');
    const centerLabel = document.getElementById('chart-center-label');
    
    if (!canvas) {
        console.log('Chart canvas not found');
        return;
    }
    
    const ctx = canvas.getContext('2d');
    const rect = canvas.getBoundingClientRect();
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const outerRadius = Math.min(centerX, centerY) - 40;
    const innerRadius = outerRadius * 0.4; // Donut chart
    
    // Default data if none provided
    if (!allocationData || allocationData.length === 0) {
        allocationData = [
            {asset: 'Equities', percentage: 45, color: '#374151'},
            {asset: 'Fixed Income', percentage: 30, color: '#6b7280'},
            {asset: 'Commodities', percentage: 10, color: '#9ca3af'},
            {asset: 'Alternatives', percentage: 10, color: '#d1d5db'},
            {asset: 'Cash', percentage: 5, color: '#f3f4f6'}
        ];
    }
    
    let currentHoverSegment = -1;
    let animationProgress = 0;
    let isAnimating = true;
    
    // Animation variables
    const animationDuration = 1500; // milliseconds
    let startTime = Date.now();
    
    function animate() {
        const elapsed = Date.now() - startTime;
        animationProgress = Math.min(elapsed / animationDuration, 1);
        
        // Ease-out animation
        const easedProgress = 1 - Math.pow(1 - animationProgress, 3);
        
        drawChart(easedProgress);
        
        if (animationProgress < 1) {
            requestAnimationFrame(animate);
        } else {
            isAnimating = false;
        }
    }
    
    function drawChart(progress = 1) {
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        let currentAngle = -Math.PI / 2; // Start at top
        
        allocationData.forEach((item, index) => {
            const sliceAngle = (item.percentage / 100) * 2 * Math.PI * progress;
            const isHovered = index === currentHoverSegment;
            const radiusOffset = isHovered ? 10 : 0;
            const currentOuterRadius = outerRadius + radiusOffset;
            
            // Draw slice
            ctx.beginPath();
            ctx.arc(centerX, centerY, innerRadius, currentAngle, currentAngle + sliceAngle);
            ctx.arc(centerX, centerY, currentOuterRadius, currentAngle + sliceAngle, currentAngle, true);
            ctx.closePath();
            
            // Gradient fill
            const gradient = ctx.createRadialGradient(centerX, centerY, innerRadius, centerX, centerY, currentOuterRadius);
            gradient.addColorStop(0, item.color);
            gradient.addColorStop(1, adjustBrightness(item.color, isHovered ? 20 : 0));
            
            ctx.fillStyle = gradient;
            ctx.fill();
            
            // Subtle border
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // Shadow for depth
            if (isHovered) {
                ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
            }
            
            // Draw percentage labels (only when animation is complete)
            if (progress > 0.8 && item.percentage >= 5) { // Only show labels for segments >= 5%
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelRadius = (innerRadius + currentOuterRadius) / 2;
                const labelX = centerX + Math.cos(labelAngle) * labelRadius;
                const labelY = centerY + Math.sin(labelAngle) * labelRadius;
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 14px Inter, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Text shadow for better readability
                ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
                ctx.shadowBlur = 3;
                ctx.fillText(`${item.percentage}%`, labelX, labelY);
            }
            
            // Reset shadow
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            
            currentAngle += sliceAngle;
        });
    }
    
    // Mouse move handler for hover effects
    canvas.addEventListener('mousemove', function(e) {
        if (isAnimating) return;
        
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        // Scale to canvas coordinates
        const canvasX = (x / rect.width) * canvas.width;
        const canvasY = (y / rect.height) * canvas.height;
        
        const dx = canvasX - centerX;
        const dy = canvasY - centerY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        
        if (distance >= innerRadius && distance <= outerRadius + 10) {
            let angle = Math.atan2(dy, dx) + Math.PI / 2;
            if (angle < 0) angle += 2 * Math.PI;
            
            let currentAngle = 0;
            let hoveredSegment = -1;
            
            for (let i = 0; i < allocationData.length; i++) {
                const sliceAngle = (allocationData[i].percentage / 100) * 2 * Math.PI;
                if (angle >= currentAngle && angle <= currentAngle + sliceAngle) {
                    hoveredSegment = i;
                    break;
                }
                currentAngle += sliceAngle;
            }
            
            if (hoveredSegment !== currentHoverSegment) {
                currentHoverSegment = hoveredSegment;
                drawChart();
                
                if (hoveredSegment >= 0) {
                    showTooltip(e, allocationData[hoveredSegment]);
                    updateCenterLabel(allocationData[hoveredSegment]);
                    canvas.style.cursor = 'pointer';
                }
            }
        } else {
            if (currentHoverSegment !== -1) {
                currentHoverSegment = -1;
                drawChart();
                hideTooltip();
                resetCenterLabel();
                canvas.style.cursor = 'default';
            }
        }
    });
    
    // Mouse leave handler
    canvas.addEventListener('mouseleave', function() {
        currentHoverSegment = -1;
        drawChart();
        hideTooltip();
        resetCenterLabel();
        canvas.style.cursor = 'default';
    });
    
    function showTooltip(e, item) {
        tooltip.innerHTML = `
            <strong>${item.asset}</strong><br>
            ${item.percentage}% of portfolio
        `;
        tooltip.style.left = e.pageX + 10 + 'px';
        tooltip.style.top = e.pageY - 10 + 'px';
        tooltip.style.opacity = '1';
    }
    
    function hideTooltip() {
        tooltip.style.opacity = '0';
    }
    
    function updateCenterLabel(item) {
        centerLabel.innerHTML = `
            <div class="chart-center-title">${item.asset}</div>
            <div class="chart-center-value">${item.percentage}%</div>
        `;
    }
    
    function resetCenterLabel() {
        centerLabel.innerHTML = `
            <div class="chart-center-title">Total Assets</div>
            <div class="chart-center-value">100%</div>
        `;
    }
    
    function adjustBrightness(color, percent) {
        // Simple brightness adjustment for hover effect
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) + amt;
        const G = (num >> 8 & 0x00FF) + amt;
        const B = (num & 0x0000FF) + amt;
        return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
            (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
    }
    
    // Start animation
    animate();
    
    console.log('Professional allocation chart created with', allocationData.length, 'segments');
}
    </script>
</body>
</html>)
